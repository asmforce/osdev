1. Перепрограммируем таймер на IRQ0

  // Удваиваем частоту генерации прерывания
  wrio8( 0x36, 0x43 );
  wrio8( 0xFF, 0x40 );
  wrio8( 0x7F, 0x40 );


Микросхема i8253(i8254) и совместимые имеют по три канала.
На вход канала подаются тактовая частота синхронизации; на ПК она одинакова для всех трёх каналов и равна 1,19318 МГц, что соответствует периоду сигнала около 838 нс. 

Через порты 0x40, 0x41, и 0x42 осуществляется чтение и запись счетчиков
каналов 0, 1, и 2 соответствено. Есть "псевдонимы" - 0x50, 0x51, и 0x52

Байт, управляющий режимом работы канала, записывается
в порт 0x43 и задаёт режим работы указанного в нём канала.

Его структура:

  [7:6] Канал:
       00 - Нулевой
       01 - Первый
       10 - Второй
       11 - Команда считывания* (см. ниже)

  [5:4] Режим чтения/записи:
       00 - команда фиксации текущего содержимого счётчика.
       01 - чтение/запись только младшего байта 
       10 - чтение/запись только старшего байта 
       11 - чтение/запись сначала младшего, а затем старшего байта

  [3:1] Режим работы канала: 
       000 - режим 0 
       001 - режим 1 
        10 - режим 2 
        11 - режим 3 
       100 - режим 4 
       101 - режим 5 

  [0] Режим счета:
       0 - двоичный счёт 
       1 - двоично-десятичный счёт 

*Команда считывания:

  [5]
     0 - текущие значения выбранных счётчиков фиксируются для последующего считывания 
     1 - текущие значения выбранных счётчиков не фиксируется 

  [4]
     0 - состояние выбранных счётчиков фиксируется для последующего считывания 
     1 - состояние выбранных счётчиков не фиксируется 

  [3]  1 - выбран счетчик 0
  [2]  1 - выбран счетчик 1
  [1]  1 - выбран счетчик 2
  [0]  Зарезервирован, должен быть равен 0

После того, как текущее значение счётчика и/или состояние зафиксированы, они хранятся в ожидании считывания, которое проводится через «личный» порт канала (40h–42h). Если одновременно зафиксированы и состояние, и значение счётчика, первым считанным байтом будет состояние, а после него последуют один или два байта счётчика (количество байтов совпадает с установленным при программировании режима работы канала). Новая операция считывания возможна только после завершения уже начатой: регистры-защёлки будут хранить зафиксированные в них значения до тех пор, пока все они не будут считаны.









Каждый канал может работать в одном из шести режимов:

0. При загрузке счетчика начинается обратный отсчет, независимо от
того, был ли закончен предыдущий отсчет. При достижении нуля на выходе
контроллера появляется высокий уровень. Счет заново не начинается, пока
не будет загружено новое значение счетчика.
// Минимальное значение, которое можно загружать - 2

1. Не доступен на ПК

2. Во время отсчета, на выходе удерживается высокий уровень. При
достижении нуля, на выходе контроллера появляется низкий уровень,
значение счетчика перезагружается исходным, на выходе восстанавливается
выссокий уровень, и счет начинается заново. При загрузке нового значения
обновление произойдет, как только закончится предыдущий отсчет, и начнется
следующий.
// Использовался для регенерации памяти
// Минимальное значение, которое можно загружать - 2

3. С каждым тактом происходит уменьшение счетчика на 2. При достижении нуля
или переполнении происходит изменение уровня сигнала на противоположный
и счет начинается сначала.
// Используется для генерации прямоугольных импульсов, в которых длительность равна скважности
// Минимальное значение, которое можно загружать - 4

4. Во время счёта на выходе поддерживается высокий уровень, а по достижении
нуля на выходе в течение одного периода синхронизации устанавливается
низкий уровень, счёт останавливается и может быть запущен заново только
повторной загрузкой начального значения.
// Минимальное значение, которое можно загружать - 1

5. Не доступен на ПК
